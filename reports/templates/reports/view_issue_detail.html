{% extends 'admin_base.html' %}
{% load static %}

{% block content %}
<div class="container py-4">

    <!-- Issue Details Card -->
    <div class="card shadow-sm rounded-4">
        <div class="card-header bg-primary text-white d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 rounded-top-4">
            <h4 class="mb-0">Issue #{{ issue.id }}</h4>
            <a href="{% url 'admin_dashboard' %}" class="btn btn-light btn-sm mt-2 mt-md-0">‚Üê Back to Dashboard</a>
        </div>

        <div class="card-body">
            <!-- Submitted By & Status -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Submitted By:</strong>
                    {% if issue.hide_identity or not issue.student %}
                        Anonymous
                    {% else %}
                        {{ issue.student.username }}
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <strong>Status:</strong>
                    <span class="badge 
                        {% if issue.status == 'pending' %} bg-warning text-dark
                        {% elif issue.status == 'in_progress' %} bg-info text-dark
                        {% elif issue.status == 'resolved' %} bg-success
                        {% elif issue.status == 'rejected' %} bg-danger
                        {% else %} bg-secondary
                        {% endif %} text-capitalize">
                        {{ issue.status }}
                    </span>
                </div>
            </div>

            <!-- Change Status Form -->
            <div class="mb-4">
                <form method="POST" class="d-flex gap-2 align-items-center flex-wrap">
                    {% csrf_token %}
                    <label class="me-2 mb-0 fw-semibold">Change Status:</label>
                    <select name="status" class="form-select w-auto">
                        <option value="pending" {% if issue.status == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="in_progress" {% if issue.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                        <option value="resolved" {% if issue.status == 'resolved' %}selected{% endif %}>Resolved</option>
                        <option value="rejected" {% if issue.status == 'rejected' %}selected{% endif %}>Rejected</option>
                    </select>
                    <button type="submit" class="btn btn-primary btn-sm">Update</button>
                </form>
            </div>

            <!-- Description -->
            <div class="mb-3">
                <strong>Description:</strong>
                <div class="border p-3 rounded bg-light small">
                    {{ issue.description }}
                </div>
            </div>

            <!-- Submitted On -->
            <div class="mb-3">
                <strong>Submitted On:</strong> {{ issue.created_at|date:"F d, Y H:i" }}
            </div>

            <!-- Attached Image -->
            {% if issue.image %}
            <div class="mb-4">
                <strong>Attached Image:</strong>
                <div class="mt-2">
                    <img src="{{ issue.image.url }}" alt="Issue Image" class="img-fluid rounded border shadow-sm" style="max-height: 400px; object-fit: contain; width: 100%;">
                </div>
            </div>
            {% endif %}

            <!-- Attached Video -->
            {% if issue.video %}
            <div class="mb-3">
                <strong>Attached Video:</strong>
                <div class="mt-2">
                    <video controls class="w-100 rounded shadow-sm" style="max-height: 400px;">
                        <source src="{{ issue.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Toast Notification for Status Update -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
    {% if messages %}
        {% for message in messages %}
        <div class="toast align-items-center text-bg-success border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    {{ message }}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        {% endfor %}
    {% endif %}
</div>

<style>
@media (max-width: 576px) {
    .card-header h4 {
        font-size: 1.2rem;
    }
    .card-body {
        font-size: 0.95rem;
    }
}
</style>

{% endblock %}

